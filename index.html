<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="public/js/d3.v3.min.js"></script>
    <script src="public/js/underscore-min.js"></script>
    <script src="public/js/jquery.min.js"></script>
</head>

<body>
    <div class="tip"></div>
    <div id="chart">
    </div>
    <script>

    //http://bl.ocks.org/mbostock/4063423
    

    
    // Dimensions of sunburst.
    var width = 750;
    var height = 600;
    var radius = Math.min(width, height) / 2;

    // Breadcrumb dimensions: width, height, spacing, width of tip/tail.
    var b = {
        w: 220,
        h: 30,
        s: 3,
        t: 10
    };

    // Mapping of step names to colors.
    var colors =
        /*{
        "Bez odgovora": "#DDD",
        "Neispunjeno": "#fecc5c",
        "DelimiÄno ispunjeno": "#7fcdbb",
        "Ispunjeno": "#2c7fb8",
        "Agencija": "#1b9e77",
        "Poverenik": "#d95f02",
        "Ombudsman": "#7570b3"
    };
*/


        ["#DDD",
            "#fecc5c",
            "#7fcdbb",
            "#2c7fb8",
            "#1b9e77",
            "#d95f02",
            "#7570b3"
        ]


    var HTMLabsoluteTip = d3.select("div.tip");


    // Total size of all segments; we set this later, after loading the data.
    var totalSize = 0;

    var vis = d3.select("#chart").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("svg:g")
        .attr("id", "container")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var partition = d3.layout.partition()
        .sort(null)
        .size([2 * Math.PI, radius * radius])
        .value(function(d) {
            return 1;
        });

    var arc = d3.svg.arc()
        .startAngle(function(d) {
            return d.x;
        })
        .endAngle(function(d) {
            return d.x + d.dx;
        })
        .innerRadius(function(d) {
            return Math.sqrt(d.y);
        })
        .outerRadius(function(d) {
            return Math.sqrt(d.y + d.dy);
        });


    d3.csv('rawData/uzorak.csv', function(err, data) {

        console.log(data)

        var json = transformData(data);

        createVisualization(json);
    })


    function transformData(all) {
        var tempObje = {
            "name": "Bezbednost",
            "children": []
        };

        var dobra = all.filter(function(la) {
            return la.predmet == "Dobra";
        })
        var usluge = all.filter(function(la) {
            return la.predmet == "usluge";
        })
        var radovi = all.filter(function(la) {
            return la.predmet == "Radovi";
        })

        tempObje.children.push({
            "name": "Dobra",
            "children": [] /*dobra*/
        });
        tempObje.children.push({
            "name": "Usluge",
            "children": [] /*usluge*/
        });
        tempObje.children.push({
            "name": "Radovi",
            "children": [] /*radovi*/
        });

        return tempObje;
    }

    function createVisualization(json) {


        // Basic setup of page elements.
        //initializeBreadcrumbTrail();



        // Bounding circle underneath the sunburst, to make it easier to detect
        // when the mouse leaves the parent g.
        vis.append("svg:circle")
            .attr("r", radius)
            .style("opacity", 0);

        // For efficiency, filter nodes to keep only those large enough to see.
        var nodes = partition.nodes(json)
            .filter(function(d) {
                return d; //(d.dx > 0.005); // 0.005 radians = 0.29 degrees
            });

        var path = vis.data([json]).selectAll("path")
            .data(nodes)
            .enter().append("svg:path")
            .attr("display", function(d) {
                return d.depth ? null : "none";
            })
            .attr("d", arc)
            .attr("fill-rule", "evenodd")
            .style("stroke", "#fff")
            .style("fill", function(d) {

                return colors[Math.floor(Math.random() * 5)];

            })
            .style("opacity", 1)
            .each(stash);
        //.on("mouseover", mouseover);

        // Add the mouseleave handler to the bounding circle.
        // d3.select("#container").on("mouseleave", mouseleave);

        // Get total size of the tree = value of root node from partition.
        totalSize = path.node().__data__.value;





        d3.selectAll("input").on("change", function change() {
	    var value = this.value === "count"
	        ? function() { return 1; }
	        : function(d) { return d.size; };

	    path
	        .data(partition.value(value).nodes)
	      .transition()
	        .duration(1500)
	        .attrTween("d", arcTween);
	  });
    };


    function stash(d) {
        d.x0 = d.x;
        d.dx0 = d.dx;
    }

    function arcTween(a) {
        var i = d3.interpolate({
            x: a.x0,
            dx: a.dx0
        }, a);
        return function(t) {
            var b = i(t);
            a.x0 = b.x;
            a.dx0 = b.dx;
            return arc(b);
        };
    }


    </script>
</body>

</html>
